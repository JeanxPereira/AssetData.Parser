<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:ReCap.Parser.Editor.ViewModels"
        x:Class="ReCap.Parser.Editor.Views.Windows.PackageBrowserWindow"
        Title="DBPF Package Browser"
        Width="900" Height="600"
        MinWidth="600" MinHeight="400"
        WindowStartupLocation="CenterOwner">
        
  <Window.DataContext>
    <vm:PackageBrowserViewModel />
  </Window.DataContext>
  
  <Grid RowDefinitions="Auto,Auto,*,Auto">
    
    <!-- Toolbar -->
    <Border Grid.Row="0" Background="#2a2a2a" Padding="8">
      <Grid ColumnDefinitions="Auto,*,Auto">
        <Button Grid.Column="0" Content="Open Package..." 
                Click="OnOpenPackageClick" 
                Padding="12,6" />
        
        <TextBlock Grid.Column="1" Text="{Binding PackageName}" 
                   VerticalAlignment="Center" HorizontalAlignment="Center"
                   FontWeight="SemiBold" FontSize="14"
                   Foreground="#e0e0e0" />
        
        <TextBlock Grid.Column="2" Text="{Binding TotalEntries, StringFormat='{}{0:N0} entries'}"
                   VerticalAlignment="Center" Margin="8,0"
                   Foreground="#808080" />
      </Grid>
    </Border>
    
    <!-- Filters -->
    <Border Grid.Row="1" Background="#252525" Padding="8">
      <Grid ColumnDefinitions="Auto,200,16,Auto,150">
        <TextBlock Grid.Column="0" Text="Search:" 
                   VerticalAlignment="Center" Margin="0,0,8,0" />
        <TextBox Grid.Column="1" 
                 Text="{Binding SearchText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                 Watermark="Filter by name..." />
        
        <TextBlock Grid.Column="3" Text="Type:" 
                   VerticalAlignment="Center" Margin="0,0,8,0" />
        <ComboBox Grid.Column="4" 
                  ItemsSource="{Binding TypeFilters}"
                  SelectedItem="{Binding SelectedTypeFilter}" />
      </Grid>
    </Border>
    
    <!-- Asset List -->
    <Border Grid.Row="2" Background="#1e1e1e">
      <DataGrid ItemsSource="{Binding FilteredEntries}"
                SelectedItem="{Binding SelectedEntry}"
                AutoGenerateColumns="False"
                CanUserResizeColumns="True"
                CanUserSortColumns="True"
                IsReadOnly="True"
                GridLinesVisibility="Horizontal"
                BorderThickness="0"
                RowBackground="#1e1e1e">
        <DataGrid.Columns>
          <DataGridTextColumn Header="Name" Binding="{Binding Name}" Width="*" />
          <DataGridTextColumn Header="Type" Binding="{Binding Type}" Width="120" />
          <DataGridTextColumn Header="Size" Binding="{Binding Size, StringFormat='{}{0:N0}'}" Width="100" />
          <DataGridCheckBoxColumn Header="Compressed" Binding="{Binding IsCompressed}" Width="90" />
        </DataGrid.Columns>
      </DataGrid>
    </Border>
    
    <!-- Status Bar -->
    <Border Grid.Row="3" Background="#2a2a2a" Padding="8,4">
      <Grid ColumnDefinitions="*,Auto">
        <TextBlock Grid.Column="0" Text="{Binding StatusText}" 
                   Foreground="#a0a0a0" VerticalAlignment="Center" />
        
        <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8">
          <Button Content="Open Asset" 
                  Command="{Binding OpenSelectedAssetCommand}"
                  IsEnabled="{Binding SelectedEntry, Converter={x:Static ObjectConverters.IsNotNull}}"
                  Padding="16,6" />
        </StackPanel>
      </Grid>
    </Border>
    
    <!-- Loading Overlay -->
    <Border Grid.RowSpan="4" 
            Background="#80000000" 
            IsVisible="{Binding IsLoading}">
      <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
        <ProgressBar IsIndeterminate="True" Width="200" />
        <TextBlock Text="{Binding StatusText}" 
                   Foreground="White" 
                   HorizontalAlignment="Center" 
                   Margin="0,8,0,0" />
      </StackPanel>
    </Border>
  </Grid>
</Window>
